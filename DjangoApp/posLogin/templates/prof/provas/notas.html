
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Notas</title>
</head>
<body>
    <header class="cabecalho">
        <nav class="menu-navegacao">
            <a href="#"><div class="icon circle-icon">perfil</div></a>
            <a href="{% url 'diario' %}"><div class="icon">diario</div></a>
        </nav>
    </header>

    <p><b><font color="red">AS NOTAS DEVEM SER INSERIDAS DE 0 A 100, SEM CASAS DECIMAIS</font></b></p>

    <section style="background-color: aquamarine;">
        <div style="background-color: rgb(0, 254, 169);">
            <h2>Lançar Notas e Média</h2>
            <h3>Avaliação</h3>
            <h3>Período Letivo: {{turma.semestre_atual}} </h3> <!---Informa o período letivo do historico de aulas-->
            <h3>Turma: S{{turma.semestre_letivo}} T{{turma.numero_turma}} {{turma.turno}} </h3> <!--Informa o semestre e a turma a qual pertece o historico de aulas-->
            <h3>Etapa: Final Exam</h3> <!--Informa a etapa da prova - Mid ou Final - -->
        </div>

        <table border="1">
            <thead>
                <tr>
                    <th>MATRÍCULA</th>
                    <th>NOME</th>
                    <th>NOTA</th>
                    <th>OBSERVAÇÕES</th>
                </tr>
            </thead>
            <tbody>
                    {% for aluno in alunos_turma %}
                    <tr id="linha-{{ aluno.matricula }}">
                        <td class="matricula"> {{ aluno.matricula }}</td>
                        <td class="nome">{{ aluno.nome_completo }}</td>
                        <td>
                            <input 
                            type="number" 
                            class="nota"
                            name="nota_{{ aluno.matricula }}
                            min="0" max="100" step="1"></td>
                        <td>
                            <input 
                            type="text"
                            class="observação"
                            name="observação_{{ aluno.matricula }}"
                            size="30"></td>

                            </tr>

                        {% endfor %}       
                    
            </tbody>
        </table>
        <td>  <button type="button" onclick="salvarNota({{aluno.matricula}})">Salvar</button>

    </section>
</body>

<script>

function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

function salvarNota(matricula) {

    obsInput = ".objetivos input";
    obsClass= ".objetivos";
    obsCampo = "objetivos";

    notaInput = ".nota input";
    notaClass= ".nota";
    notaCampo = "nota";

    const dados = [];
    document.querySelectorAll('tbody tr').forEach(linha => {
        const matricula = linha.querySelector('.matricula').textContent.trim();
        const nota = linha.querySelector('.nota').value;
        const observacao = linha.querySelector('.observação').value;

        dados.push({
            matricula: matricula,
            nota: nota,
            observacao: observacao
        });
    });

    console.log(dados); // Enviar para o backend com fetch() ou AJAX

  fetch("/pagProf/aulas/notas/", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "X-CSRFToken": getCookie("csrftoken"), 
  },
  body: JSON.stringify({
    dados: dados,
  }),
})
  .then(response => {
    if (!response.ok) {
      throw new Error("Erro ao salvar");
    }
    return response.json();
  })
  .then(data => {
    console.log("Salvo com sucesso!", data);
  })
  .catch(error => {
    alert("Erro ao salvar no banco.");
    console.error(error);
  });
  
  }
  
  
  </script>


</html>
