<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Lista de Frequência</title>
</head>
<body>
    <h1>Frequência - {{ turma.semestre_letivo }}</h1>
    <h2>Turma: {{ turma }}</h2>

    <form method="POST">
        {% csrf_token %}
        
        <label for="data">Data da nova aula:</label>
        <input type="date" name="data" id="data" required>
        <button type="submit">Salvar Frequência</button>

        <table border="1" cellpadding="5">
            <thead>
                <tr>
                    <th>Matrícula</th>
                    <th>Nome</th>
                    {% for aula in aulas %}
                        <th>{{ aula.data|date:"d/m" }}</th>
                    {% endfor %}
                    <th>Total Presenças</th>
                </tr>
            </thead>
            <tbody>
                {% for aluno in alunos %}
                    <tr>
                        <td>{{ aluno.matricula }}</td>
                        <td>{{ aluno.nome_completo }}</td>
                        
                        {% for aula in aulas %}
                            {% with presenca=False %}
                                {% for freq in frequencias %}
                                    {% if freq.aluno.id == aluno.id and freq.aula.id == aula.id %}
                                        {% with presenca=freq.presenca %}
                                        {% endwith %}
                                    {% endif %}
                                {% endfor %}
                                <td>
                                    <input type="checkbox" name="presenca_{{ aluno.matricula }}_{{ aula.id }}" {% if presenca %}checked{% endif %}>
                                </td>
                            {% endwith %}
                        {% endfor %}

                        <td>
                            {{
                                frequencias|dictfilter:aluno.id|dictsum
                            }}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </form>
</body>
</html>
